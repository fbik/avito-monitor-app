FROM node:18-alpine

# Устанавливаем Chromium для puppeteer
RUN apk add --no-cache \
    chromium \
    ca-certificates \
    tzdata \
    && rm -rf /var/cache/apk/*

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем package.json
COPY package*.json ./

# Устанавливаем все зависимости (включая dev)
RUN npm install

# Копируем исходный код
COPY . .

# Настройки окружения
ENV PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser
ENV CHROME_PATH=/usr/bin/chromium-browser
ENV NODE_ENV=development
ENV TZ=Europe/Moscow

# Открываем порты
EXPOSE 3000 3001 9229

# Запускаем в режиме разработки
CMD ["npm", "run", "start:dev"]
